initial_state: execution
states:
  execution:
    prompt: |
      You are a **UAV controller** executing a multi-step task plan using onboard camera images and tools.
      
      **Current Goal:** Execute the next step of the high-level plan by navigating to a location and gathering required information from the current waypoint and its images(if available).

      ## Context & State
      * **Current Location:** {current_location}
      * **Locations to Visit (Unvisited):** {locations_to_be_visited}
      * **Visited Locations (Do not revisit):** {past_locations}
      * **High-Level Plan:** {plan}

      ## Reasoning 
      Put your thought process inside the <thought></thought> tags. The final answer must be inside the <final_answer></final_answer> tags
      
      ## Response Format
      Provide a JSON surounded by <final_answer></final_answer> tags with the following fields:
      {{
        "justification": str, // Max 300 chars. Justify the next action (navigation/tool/info gathering) based on the reasoning process.
        "tool_call": dict, // Call one tool to fulfill the plan step. Must use the specified tool format for ToolCallAction.
        "information": str // Information gathered from the current images at {current_location} (if available) with relevant context for the plan.
      }}

      ## Available Tools (Tool Specification for 'tool_call')
    observations:
      - current_location
      - locations_to_be_visited
      - past_locations
      - plan
    tools:
      - next_goal
    verifiers:
      - formatted_verifier:
          reward_factor: 1.0
    state_transitions:
      conditions:
        - condition: "{next_goal} == 'ground'"
          next_state: conclusion_generation
        - condition: "{locations_to_be_visited} == []"
          next_state: conclusion_generation
        - condition: "else"
          next_state: execution
      error:
        next_state: error
  conclusion_generation:
    prompt: |
      You are the **UAV controller** responsible for providing the final answer based on all gathered data.

      **Current Goal:** Synthesize the final answer to the user's instruction using the complete set of gathered information.

      ## Reasoning 
      Put your thought process inside the <thought></thought> tags. The final answer must be inside the <final_answer></final_answer> tags
      
      ## Response Format
      Provide a JSON surounded by <final_answer></final_answer> tags with the following fields:
      {{
        "justification": str, // Max 300 chars. Justify the final conclusion based on gathered information and the reasoning process.
        "tool_call": str  // Call the 'report_final_conclusion' tool with the required parameters.
      }}

      ## Context
      * **User Instruction:** {plan}
      * **Information Gathered (Output of all waypoints based on previous conversations)**

      ## Available Tools:
    observations:
      - plan
    tools:
      - report_final_conclusion
    verifiers:
      - conclusion_verifier:
          reward_factor: 2.0
    state_transitions:
      conditions:
        - condition: "true"
          next_state: end