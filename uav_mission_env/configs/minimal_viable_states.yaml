initial_state: execution
image_resolution: 
  width: 640
  height: 480
states:
  execution:
    prompt: |
      You are a **UAV controller** executing a multi-step task plan using onboard camera images and tools.
      
      **Current Goal:** Execute the next step of the high-level plan by navigating to a location and gathering required information from the current waypoint and its images(if available).

      ## Context & State
      * **Current Location:** {current_location}
      * **Locations to Visit (Unvisited):** {locations_to_be_visited}
      * **Visited Locations (Do not revisit):** {past_locations}
      * **High-Level Plan:** {plan}

      ## Reasoning 
      Put your thought process inside the <think></think> tags. Than return the final answer outside the tags.
      
      ## Response Format
      Provide the answer as JSON-Object with the following fields:
      {{
        "justification": str, // Justify the next action (navigation/tool/info gathering) based on the reasoning process.
        "tool_call": object, // Call one tool to fulfill the plan step. Must use the specified tool format for ToolCallAction.
        "information": str // Information gathered from the current images at {current_location} (if available) with relevant context for the plan.
      }}

      ## Available Tools (Tool Specification for 'tool_call')
    output_keys:
      - justification:
          type: string
          max_length: 300
      - tool_call:
          type: object
      - information:
          type: string
          max_length: 300
    observations:
      - current_location
      - locations_to_be_visited
      - past_locations
      - plan
    tools:
      - next_goal
    verifiers:
      - formatted_verifier:
          reward_factor: 1.0
    state_transitions:
      conditions:
        - condition: "{next_goal} == 'ground'"
          next_state: conclusion_generation
        - condition: "{locations_to_be_visited} == []"
          next_state: conclusion_generation
        - condition: "else"
          next_state: execution
      error:
        next_state: error
  conclusion_generation:
    prompt: |
      You are the **UAV controller** responsible for providing the final answer based on all gathered data.

      **Current Goal:** Synthesize the final answer to the user's instruction using the complete set of gathered information.

      ## Reasoning 
      Put your thought process inside the <think></think> tags. Than return the final answer outside the tags.
      
      ## Response Format
      Provide the answer as JSON-Object with the following fields:
      {{
        "justification": str, // Justify the final conclusion based on gathered information and the reasoning process.
        "tool_call": object  // Call the 'report_final_conclusion' tool with the required parameters.
      }}

      ## Context
      * **User Instruction:** {plan}
      * **Information Gathered (Output of all waypoints based on previous conversations)**

      ## Available Tools:
    output_keys:
      - justification:
          type: string
          max_length: 300
      - tool_call:
          type: object
    observations:
      - plan
    tools:
      - report_final_conclusion
    verifiers:
      - conclusion_verifier:
          reward_factor: 2.0
    state_transitions:
      conditions:
        - condition: "True"
          next_state: end